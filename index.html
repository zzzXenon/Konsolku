<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Konsolku v2</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    
    <script>
      (function() {
        const userTheme = localStorage.getItem("theme");
        const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches;
        if (userTheme === "dark" || (!userTheme && systemTheme)) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      })();
    </script>
  </head>

  <body
    ng-app="konsolku"
    ng-controller="mainController"
    class="h-screen flex overflow-hidden text-sm antialiased transition-colors duration-300 bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100"
  >
    <aside
      ng-if="!isLoginPage"
      class="w-64 flex flex-col border-r transition-colors duration-300 bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700"
    >
      <div
        class="p-6 text-xl font-bold border-b transition-colors duration-300 border-gray-200 text-teal-600 dark:border-gray-700 dark:text-teal-400 flex justify-between items-center"
      >
        <span>Konsolku v2</span>

        <button
          ng-click="logout()"
          title="Logout"
          class="text-xs text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition-colors"
        >
          <i class="fa fa-power-off fa-lg"></i>
        </button>
      </div>

      <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
        <div ng-repeat="item in menuItems">
          <a
            ng-if="!item.children"
            ui-sref="{{item.state}}"
            ui-sref-active="bg-teal-50 text-teal-700 font-semibold dark:bg-gray-700 dark:text-teal-300"
            class="block px-4 py-3 rounded-lg transition-all cursor-pointer flex items-center gap-3 mb-1 text-gray-600 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <i class="{{item.icon}} w-5 text-center"></i>
            <span>{{item.label}}</span>
          </a>

          <div ng-if="item.children">
            <button
              ng-click="toggleItem(item)"
              class="w-full text-left px-4 py-3 rounded-lg transition-all cursor-pointer flex items-center justify-between mb-1 text-gray-600 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
            >
              <div class="flex items-center gap-3">
                <i class="{{item.icon}} w-5 text-center"></i>
                <span>{{item.label}}</span>
              </div>
              <i
                class="fa-solid fa-chevron-down text-xs transition-transform duration-200"
                ng-class="{'rotate-180': item.isOpen}"
              ></i>
            </button>

            <div
              ng-show="item.isOpen"
              class="ml-4 pl-4 border-l border-gray-200 dark:border-gray-700 space-y-1 mt-1"
            >
              <a
                ng-repeat="child in item.children"
                ui-sref="{{ child.state }}"
                ui-sref-active="text-teal-600 font-semibold dark:text-teal-400"
                class="block px-4 py-2 text-sm rounded-md transition cursor-pointer flex items-center gap-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700/50"
              >
                <i class="{{child.icon}} w-4 text-center"></i>
                <span>{{child.label}}</span>
              </a>
            </div>
          </div>
        </div>
      </nav>

      <div
        class="p-4 border-t transition-colors duration-300 border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"
      >
        <button
          ng-click="toggleTheme()"
          class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-lg transition-all duration-300 border shadow-sm select-none bg-white border-gray-200 text-gray-700 hover:bg-gray-100 hover:border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600 dark:hover:border-gray-500"
        >
          <i class="fa-solid fa-sun text-yellow-400" ng-show="!isDarkMode"></i>
          <i class="fa-solid fa-moon text-indigo-500" ng-show="isDarkMode"></i>

          <span class="font-medium">
            {{ isDarkMode ? 'Dark Mode' : 'Light Mode' }}
          </span>
        </button>
      </div>
    </aside>

    <main
      class="flex-1 overflow-y-auto relative transition-all duration-300"
      ng-class="{'p-0': isLoginPage, 'p-8': !isLoginPage}"
    >
      <ui-view></ui-view>
    </main>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>